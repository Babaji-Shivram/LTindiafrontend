<div class="page" *ngIf="lead">
  <div class="page-header">
    <h1 class="page-title">
      <span class="material-icons">visibility</span>
      Lead Details: {{lead.id}}
    </h1>
    <div class="actions">
      <button (click)="goBack()" class="btn btn-secondary">
        <span class="material-icons">arrow_back</span>
        Back to Leads
      </button>
      <button (click)="editLead()" class="btn btn-primary">
        <span class="material-icons">edit</span>
        Edit Lead
      </button>
    </div>
  </div>

  <!-- Step 1: Company Information -->
  <section class="detail-section">
    <div class="section-header">
      <h3 class="section-title">
        <span class="material-icons">business</span>
        Company Information
      </h3>
    </div>
    <div class="info-grid">
      <div class="info-item">
        <label>Company Name:</label>
        <span class="value">{{lead.company}}</span>
      </div>
      <div class="info-item" *ngIf="lead.companyTypeID">
        <label>Company Type:</label>
        <span class="value">{{lead.companyTypeID}}</span>
      </div>
      <div class="info-item">
        <label>Address:</label>
        <span class="value">{{ getCompanyAddress() || 'Not provided' }}</span>
      </div>
      <div class="info-item">
        <label>Registration Number:</label>
        <span class="value">{{ getRegistrationNumber() || 'Not provided' }}</span>
      </div>
    </div>
  </section>

  <!-- Step 2: Business Classification -->
  <section class="detail-section">
    <div class="section-header">
      <h3 class="section-title">
        <span class="material-icons">category</span>
        Business Classification
      </h3>
    </div>
    <div class="info-grid">
      <div class="info-item">
        <label>Customer Sector:</label>
        <span class="value">{{ getCustomerSector() || 'Not specified' }}</span>
      </div>
      <div class="info-item" *ngIf="lead.businessCategoryID">
        <label>Business Category:</label>
        <span class="value">{{lead.businessCategoryID}}</span>
      </div>
      <div class="info-item">
        <label>Annual Turnover:</label>
        <span class="value">{{ getAnnualTurnover() || 'Not specified' }}</span>
      </div>
      <div class="info-item">
        <label>Employee Count:</label>
        <span class="value">{{ getEmployeeCount() || 'Not specified' }}</span>
      </div>
    </div>
  </section>

  <!-- Step 3: Contact Information -->
  <section class="detail-section">
    <div class="section-header">
      <h3 class="section-title">
        <span class="material-icons">person</span>
        Contact Information
      </h3>
    </div>
    <div class="info-grid">
      <div class="info-item">
        <label>Contact Person:</label>
        <span class="value">{{lead.contact}}</span>
      </div>
      <div class="info-item" *ngIf="lead.roleId">
        <label>Designation/Role:</label>
        <span class="value">{{lead.roleId}}</span>
      </div>
      <div class="info-item" *ngIf="lead.email">
        <label>Email:</label>
        <span class="value">
          <a href="mailto:{{lead.email}}" class="contact-link">{{lead.email}}</a>
        </span>
      </div>
      <div class="info-item" *ngIf="lead.mobileNo">
        <label>Mobile Number:</label>
        <span class="value">
          <a href="tel:{{lead.mobileNo}}" class="contact-link">{{lead.mobileNo}}</a>
        </span>
      </div>
      <div class="info-item" *ngIf="lead.phone">
        <label>Phone Number:</label>
        <span class="value">
          <a href="tel:{{lead.phone}}" class="contact-link">{{lead.phone}}</a>
        </span>
      </div>
    </div>
  </section>

  <!-- Step 4: Lead Source -->
  <section class="detail-section">
    <div class="section-header">
      <h3 class="section-title">
        <span class="material-icons">source</span>
        Lead Source
      </h3>
    </div>
    <div class="info-grid">
      <div class="info-item">
        <label>Lead Source:</label>
        <span class="value">{{lead.leadSourceID || 'Unknown'}}</span>
      </div>
      <div class="info-item" *ngIf="lead.leadSourceValue">
        <label>Source Details:</label>
        <span class="value">{{lead.leadSourceValue}}</span>
      </div>
      <div class="info-item">
        <label>Created Date:</label>
        <span class="value">{{(lead.createdOn | date:'MMM d, yyyy') || 'Not available'}}</span>
      </div>
    </div>
  </section>

  <!-- Step 5: Sales Assignment -->
  <section class="detail-section">
    <div class="section-header">
      <h3 class="section-title">
        <span class="material-icons">assignment_ind</span>
        Sales Assignment
      </h3>
    </div>
    <div class="info-grid">
      <div class="info-item">
        <label>Assigned Branch:</label>
        <span class="value">{{ getAssignedBranch() || 'Not assigned' }}</span>
      </div>
      <div class="info-item" *ngIf="lead.owner">
        <label>Sales Person:</label>
        <span class="value">{{lead.owner}}</span>
      </div>
      <div class="info-item" *ngIf="lead.value">
        <label>Estimated Value:</label>
        <span class="value currency">â‚¹{{lead.value | number:'1.2-2'}}</span>
      </div>
      <div class="info-item">
        <label>Expected Closure:</label>
        <span class="value">{{ getExpectedClosure() || 'Not set' }}</span>
      </div>
      <div class="info-item">
        <label>Priority:</label>
        <span class="priority-chip priority-medium">MEDIUM</span>
      </div>
    </div>
  </section>

  <!-- Step 6: Service Requirements -->
  <section class="detail-section">
    <div class="section-header">
      <h3 class="section-title">
        <span class="material-icons">build</span>
        Service Requirements
      </h3>
    </div>
    <div class="service-requirements">
      <div class="service-item" *ngFor="let service of getServiceRequirements(); trackBy: trackByService">
        <div class="service-header">
          <span class="service-name">{{ service.serviceName }}</span>
          <span class="service-location">{{ service.location }}</span>
        </div>
        <div class="service-details" *ngIf="service.description">
          <span class="service-description">{{ service.description }}</span>
        </div>
        <div class="service-timeline" *ngIf="service.timeline">
          <span class="label">Timeline:</span>
          <span class="value">{{ service.timeline }}</span>
        </div>
      </div>
      <div class="no-services" *ngIf="getServiceRequirements().length === 0">
        <p>No service requirements specified</p>
      </div>
    </div>
  </section>

  <!-- Lead Status & Tracking -->
  <section class="detail-section">
    <div class="section-header">
      <h3 class="section-title">
        <span class="material-icons">track_changes</span>
        Lead Status & Tracking
      </h3>
    </div>
    <div class="info-grid">
      <div class="info-item">
        <label>Current Stage:</label>
        <span class="stage-chip" [class]="'stage-' + (lead.stage || 'new').toLowerCase().replace(' ', '-')">
          {{lead.stage || 'New'}}
        </span>
      </div>
      <div class="info-item" *ngIf="lead.nextFollowUp">
        <label>Next Follow-up:</label>
        <span class="value">{{lead.nextFollowUp | date:'MMM d, yyyy'}}</span>
      </div>
      <div class="info-item">
        <label>Status Flags:</label>
        <div class="flags-container">
          <span *ngIf="lead.isEnquiry" class="flag-chip flag-enquiry">Enquiry</span>
          <span *ngIf="lead.isQuote" class="flag-chip flag-quote">Quote</span>
          <span *ngIf="lead.isKYC" class="flag-chip flag-kyc">KYC</span>
          <span *ngIf="lead.isContract" class="flag-chip flag-contract">Contract</span>
          <span *ngIf="!lead.isEnquiry && !lead.isQuote && !lead.isKYC && !lead.isContract" class="no-flags">No active flags</span>
        </div>
      </div>
    </div>
  </section>

  <!-- Additional Notes -->
  <section class="detail-section" *ngIf="getAdditionalNotes()">
    <div class="section-header">
      <h3 class="section-title">
        <span class="material-icons">note</span>
        Additional Notes
      </h3>
    </div>
    <div class="notes-content">
      <p>{{ getAdditionalNotes() }}</p>
    </div>
  </section>
</div>

<div class="page-empty" *ngIf="!lead">
  <div class="empty-state">
    <span class="material-icons large">search_off</span>
    <h3>Lead Not Found</h3>
    <p>The requested lead could not be found.</p>
    <button (click)="goBack()" class="btn btn-primary">
      <span class="material-icons">arrow_back</span>
      Back to Leads
    </button>
  </div>
</div>
