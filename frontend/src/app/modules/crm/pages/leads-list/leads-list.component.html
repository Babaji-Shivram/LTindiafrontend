<div class="page">
  <div class="page-header">
    <h1 class="page-title">Leads</h1>
    <div class="actions">
      <a routerLink="/crm/leads/new" class="btn btn-primary">+ New Lead</a>
    </div>
  </div>

  <div class="toolbar">
    <input type="search" [(ngModel)]="q" placeholder="Search company, contact, email, mobile..." />
    <select [(ngModel)]="stage">
      <option>All</option><option>New</option><option>Qualified</option>
      <option>Proposal</option><option>Negotiation</option>
      <option>Approval Pending</option><option>Won</option>
      <option>Lost</option><option>On Hold</option><option>Rejected</option>
    </select>
    <select [(ngModel)]="owner">
      <option>All</option><option>Alex</option><option>Dana</option>
    </select>
  </div>

  <div class="table-wrap">
    <table class="table">
      <thead>
        <tr>
          <th>Lead ID</th>
          <th>Company</th>
          <th>Contact Person</th>
          <th>Email</th>
          <th>Mobile</th>
          <th>Lead Source</th>
          <th>Sales Person</th>
          <th>Est. Value</th>
          <th>Priority</th>
          <th>Stage</th>
          <th>Created Date</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let l of filtered$ | async" class="row-link">
          <td>
            <a 
              class="lead-id-link" 
              (click)="open(l.id)"
              title="View Lead Details">
              {{l.id}}
            </a>
          </td>
          <td>
            <div class="company-info">
              <div class="company-name">{{l.company}}</div>
              <div class="company-type">{{l.companyTypeID || '-'}}</div>
            </div>
          </td>
          <td>
            <div class="contact-info">
              <div class="contact-name">{{l.contact}}</div>
              <div class="contact-role">{{l.roleId || '-'}}</div>
            </div>
          </td>
          <td>
            <a href="mailto:{{l.email}}" class="email-link">{{l.email}}</a>
          </td>
          <td>
            <a href="tel:{{l.mobileNo}}" class="phone-link">{{l.mobileNo}}</a>
          </td>
          <td class="source-cell">
            <div class="source-info">
              <div class="source-name">{{l.leadSourceID || 'Unknown'}}</div>
              <div class="source-value" *ngIf="l.leadSourceValue">{{l.leadSourceValue}}</div>
            </div>
          </td>
          <td>{{l.owner || 'Unassigned'}}</td>
          <td class="value-cell">
            <span *ngIf="l.value">â‚¹{{l.value | number:'1.0-0'}}</span>
            <span *ngIf="!l.value" class="text-muted">-</span>
          </td>
          <td>
            <span class="priority-chip priority-medium">
              MEDIUM
            </span>
          </td>
          <td>
            <span class="stage-chip" [class]="'stage-' + (l.stage || 'new').toLowerCase().replace(' ', '-')">
              {{l.stage || 'New'}}
            </span>
          </td>
          <td>{{l.createdOn | date:'MMM d, y'}}</td>
          <td class="actions-cell">
            <button 
              class="btn-icon" 
              (click)="open(l.id)" 
              title="View Details">
              <span class="material-icons">visibility</span>
            </button>
            <button 
              class="btn-icon" 
              (click)="edit(l.id)" 
              title="Edit Lead">
              <span class="material-icons">edit</span>
            </button>
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</div>
